<div class="care-body">
    <care-navbar></care-navbar>

    <div class="care-receiver-header">
        <div class="care-receiver-info">
            <select class="receiver-select" [(ngModel)]="selectedReceiverId" (change)="onReceiverChange()">
                <option *ngFor="let r of receivers" [value]="r.receiverId">
                    {{ r.firstName }} {{ r.lastName }}
                </option>
            </select>
        </div>
        <div class="care-receiver-actions">
            <button matButton="filled" (click)="showAddReceiverModal = true" title="Add Care Receiver">
                Add Care Receiver
            </button>
            <button matButton="filled" (click)="showAddCareGiverModal = true" title="Add Additional Care Giver">
                Add Additional Care Giver
            </button>
        </div>
    </div>

    <care-event-table [events]="events" [eventTypes]="eventTypes" (newEvent)="getLatestEvents()"
        (eventToDelete)="handleDeleteEvent($event)"></care-event-table>


    <care-calendar [events]="events" (eventToDelete)="handleDeleteEvent($event)"
        (eventToView)="handleViewEvent($event)"></care-calendar>
</div>

<care-modal [show]="showAddReceiverModal" header="Add Care Receiver" (close)="showAddReceiverModal = false">
    <div modal-body>
        <form (ngSubmit)="submitAddReceiver()" #addReceiverForm="ngForm">
            <mat-form-field>
                <mat-label>First Name</mat-label>
                <input matInput [(ngModel)]="newReceiver.firstName" name="firstName" required class="form-control">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Last Name</mat-label>
                <input matInput [(ngModel)]="newReceiver.lastName" name="lastName" required class="form-control">
            </mat-form-field>
        </form>
    </div>
    <div modal-footer>
        <button matButton="filled" class="modal-button" (click)="submitAddReceiver()">Add</button>
        <button matButton="filled" class="secondary-button modal-button"
            (click)="showAddReceiverModal = false">Cancel</button>
    </div>
</care-modal>

<care-modal [show]="showAddCareGiverModal" header="Add Additional Care Giver" (close)="showAddCareGiverModal = false">
    <div modal-body>
        <form (ngSubmit)="submitAddCareGiver()" #addCareGiverForm="ngForm">
            <mat-form-field>
                <mat-label>Email</mat-label>
                <input matInput [(ngModel)]="additionalCareGiverEmail" name="careGiverEmail" required
                    class="form-control">
            </mat-form-field>
        </form>
    </div>
    <div modal-footer>
        <button matButton="filled" class="modal-button" (click)="submitAddCareGiver()">Add</button>
        <button matButton="filled" class="secondary-button modal-button"
            (click)="showAddCareGiverModal = false">Cancel</button>
    </div>
</care-modal>


@if (selectedEvent){
<care-event-modal [event]="selectedEvent" [(eventAction)]="eventAction" [(showModal)]="showEventModal"
    (eventChange)="getLatestEvents()"></care-event-modal>
}

<care-alert></care-alert>