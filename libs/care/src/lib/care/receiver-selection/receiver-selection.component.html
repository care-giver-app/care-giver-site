<div class="receiver-selection-container">
    @if (isLoading){
        <div class="current-receiver-button skeleton-button"></div>
    }
    @else {
    <button class="current-receiver-button" matMiniFab aria-label="Current receiver"
        [matMenuTriggerFor]="currentReceiverMenu" title="Current Care Receiver">
        <strong> {{ getInitials() }} </strong>
    </button>
    }
    <mat-menu #currentReceiverMenu="matMenu">
        <button mat-menu-item (click)="showAddCareGiverModal = true">Add Additional Care Giver</button>
    </mat-menu>

    <button class="change-receiver-button" matIconButton aria-label="Change receiver"
        [matMenuTriggerFor]="changeReceiverMenu" title="Change Care Receiver">
        <mat-icon>swap_horiz</mat-icon>
    </button>
    <mat-menu #changeReceiverMenu="matMenu">
        @for (receiver of receivers; track receiver.receiverId) {
        <button mat-menu-item (click)="selectReceiver(receiver.receiverId)"><mat-icon>person</mat-icon>{{
            receiver.firstName }} {{
            receiver.lastName }}</button>
        }
        <button mat-menu-item (click)="showAddReceiverModal = true"><mat-icon>add</mat-icon>New
            Receiver</button>
    </mat-menu>
</div>


<care-modal [show]="showAddReceiverModal" header="Add Care Receiver" (close)="showAddReceiverModal = false">
    <div modal-body>
        <form (ngSubmit)="submitAddReceiver()" #addReceiverForm="ngForm">
            <mat-form-field>
                <mat-label>First Name</mat-label>
                <input matInput [(ngModel)]="newReceiver.firstName" name="firstName" required class="form-control">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Last Name</mat-label>
                <input matInput [(ngModel)]="newReceiver.lastName" name="lastName" required class="form-control">
            </mat-form-field>
        </form>
    </div>
    <div modal-footer>
        <button matButton="filled" class="modal-button" (click)="submitAddReceiver()">Add</button>
        <button matButton="filled" class="secondary-button modal-button"
            (click)="showAddReceiverModal = false">Cancel</button>
    </div>
</care-modal>


<care-modal [show]="showAddCareGiverModal" header="Add Additional Care Giver" (close)="showAddCareGiverModal = false">
    <div modal-body>
        <form (ngSubmit)="submitAddCareGiver()" #addCareGiverForm="ngForm">
            <mat-form-field>
                <mat-label>Email</mat-label>
                <input matInput [(ngModel)]="additionalCareGiverEmail" name="careGiverEmail" required
                    class="form-control">
            </mat-form-field>
        </form>
    </div>
    <div modal-footer>
        <button matButton="filled" class="modal-button" (click)="submitAddCareGiver()">Add</button>
        <button matButton="filled" class="secondary-button modal-button"
            (click)="showAddCareGiverModal = false">Cancel</button>
    </div>
</care-modal>